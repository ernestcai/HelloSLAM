function [M,lns] = extractManhattan(g_sph,votes,dList,Rraw,K)
    % Manhattan frame extraction(only extract the frame from 1st frame)
    sorted_votes = sort(votes,'descend');
    for i = 1:400
        z = [0;0;1];
        idx = find(votes == sorted_votes(i));
        ptz = g_sph(:,votes(idx(1)));
        angle = acosd(dot(ptz,z)/norm(ptz)/norm(z));
        if (angle > 180)
            angle = 360 - angle; 
        end
        if (angle < 10)
            man_z = ptz;
            zi = zii;
        end
    end
    
    for i = 1:500
        idx = find(votes == sorted_votes(i));
        ptx = g_sph(:,votes(idx(1)));
        angle = acosd(dot(ptx,man_z)/norm(ptx)/norm(man_z));
        if (angle > 180)
            angle = 360 - angle; 
        end
        angle = abs(90 - angle);
        if (angle < 3)
            man_x = ptx;
            disp(i);
            break
        end
    end
    
    man_y = cross(man_x,man_z)/norm(cross(man_x,man_z));
    
    C = K;
    
    M = [man_x man_y man_z]
    for i = 1:size(dList,1)
        disp(strcat('Marking: ',num2str(i)));
        lines = load(fullfile(dList(i).folder,dList(i).name));
        lns{i} = lines.lines;
        marker = zeros(1,size(lns{i},2));
        lbg = [lns{i}(1:2,:);ones(1,size(lns{i},2))];
        led = [lns{i}(3:4,:);ones(1,size(lns{i},2))];
        R = rotationVectorToMatrix(Rraw(i,:));
        C = R'*C;
        lbg_h = C\lbg;
        led_h = C\led;
        for j = 1:size(lns{i},1)
            a = lbg_h(:,j);
            b = led_h(:,j);
            pt = cross(a,b)./(norm(cross(a,b)));
            for k = 1:3
                m = M(:,k);
                angle = acosd(dot(pt,m)/norm(pt)/norm(m));
                if (angle > 180)
                    angle = 360 - angle;
                end
                angle = abs(90 - angle);
                 if (angle < 5)
                    marker(:,j) = k;
                    break
                 end
            end
        end
        lns{i} = [lns{i};marker];
    end
            
end